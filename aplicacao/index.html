<!DOCTYPE html>

<html lang="pt">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Folha de Controlo de Obra - Rel√≥gio</title>

    <link rel="stylesheet" href="styles.css">

</head>

<body>

    <div id="inactivityModal" class="modal">

        <div class="modal-content">

            <h2>‚ö†Ô∏è Inatividade Detectada</h2>

            <p>N√£o detect√°mos actividade h√° <strong id="inactivityTime">5 minutos</strong>.</p>

            <p>O timer foi <strong>pausado automaticamente</strong> para garantir precis√£o no registo de horas.</p>

            <div class="info-panel">

                <strong>Tempo pausado:</strong> <span id="pausedDuration">0m 0s</span>

            </div>

            <p style="font-size: 14px; color: #6c757d; margin-top: 15px;">Deseja retomar o trabalho?</p>

            <div class="modal-buttons">

                <button class="btn btn-success" onclick="resumeTimer()">‚úì Retomar</button>

                <button class="btn btn-danger" onclick="stopWorkFromInactivity()">‚úó Parar</button>

            </div>

        </div>

    </div>



    <div id="confirmModal" class="modal">

        <div class="modal-content">

            <h2 id="confirmTitle">Confirmar</h2>

            <div class="confirm-dialog">

                <p id="confirmMessage"></p>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-success" id="confirmYes">Sim</button>

                <button class="btn btn-secondary" id="confirmNo">N√£o</button>

            </div>

        </div>

    </div>



    <div id="alertModal" class="modal">

        <div class="modal-content">

            <h2 id="alertTitle">Aviso</h2>

            <div class="confirm-dialog">

                <p id="alertMessage"></p>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-primary" id="alertOk">OK</button>

            </div>

        </div>

    </div>



    <div id="newProjectModal" class="modal">

        <div class="modal-content">

            <h2>üÜï Abrir Nova Obra</h2>

            <div id="newProjectError" class="error-message hidden"></div>

            <div id="newProjectSuccess" class="success-message hidden"></div>

            <div class="form-group">

                <label>C√≥digo da Obra *</label>

                <input type="text" id="newProjectCode" placeholder="Ex: 1234\5678 90 123 - 4567">

            </div>

            <div class="form-group">

                <label>Nome da Obra *</label>

                <input type="text" id="newProjectName" placeholder="Ex: Instala√ß√£o Sistema AVAC - Empresa XYZ">

            </div>

            <div class="form-group">

                <label>Observa√ß√µes (opcional)</label>

                <textarea id="newProjectNotes" placeholder="Informa√ß√µes adicionais sobre a obra..."></textarea>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-success" onclick="createNewProject()">‚úì Criar Obra</button>

                <button class="btn btn-secondary" onclick="closeNewProjectModal()">Cancelar</button>

            </div>

        </div>

    </div>



    <div id="reopenProjectModal" class="modal">

        <div class="modal-content">

            <h2>üîÑ Reabrir Obra</h2>

            <div id="reopenProjectError" class="error-message hidden"></div>

            <div class="info-panel" style="margin-bottom: 20px;">

                <div class="info-item">

                    <span class="label">C√≥digo:</span>

                    <span class="value" id="reopenProjectCode">-</span>

                </div>

                <div class="info-item">

                    <span class="label">Nome:</span>

                    <span class="value" id="reopenProjectName">-</span>

                </div>

            </div>

            <div class="form-group">

                <label>Motivo da Reabertura *</label>

                <select id="reopenReason">

                    <option value="">Selecione o motivo</option>

                    <option value="client_change">Altera√ß√£o do Cliente</option>

                    <option value="our_error">Erro Nosso</option>

                </select>

            </div>

            <div class="form-group">

                <label>Coment√°rio (opcional)</label>

                <textarea id="reopenComment" placeholder="Descreva o motivo da reabertura..."></textarea>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-warning" onclick="confirmReopenProject()">üîÑ Reabrir Obra</button>

                <button class="btn btn-secondary" onclick="closeReopenProjectModal()">Cancelar</button>

            </div>

        </div>

    </div>



    <div id="editModal" class="modal">

        <div class="modal-content">

            <h2>‚úèÔ∏è Editar Sess√£o</h2>

            <div id="editError" class="error-message hidden"></div>

            <div id="editSuccess" class="success-message hidden"></div>

            <div class="radio-group">

                <div class="radio-option">

                    <input type="radio" id="editWorkTypeProject" name="editWorkType" value="project" checked onchange="updateEditFields()">

                    <label for="editWorkTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>

                </div>

                <div class="radio-option internal">

                    <input type="radio" id="editWorkTypeInternal" name="editWorkType" value="internal" onchange="updateEditFields()">

                    <label for="editWorkTypeInternal" class="radio-label">üè† Trabalho Interno</label>

                </div>

            </div>

            <div id="editProjectFields">

                <div class="form-group">

                    <label>Selecione a Obra</label>

                    <select id="editProjectSelect" onchange="updateEditProjectInfo()">

                        <option value="">-- Selecione uma obra --</option>

                    </select>

                </div>

                <div class="form-group">

                    <label>Departamento / Tipo de Projeto</label>

                    <select id="editProjectType" onchange="updateEditSubcategories()">

                        <option value="">Selecione o departamento</option>

                        <option value="projeto">Projeto</option>

                        <option value="eletrico">El√©trico</option>

                        <option value="desenvolvimento">Desenvolvimento</option>

                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>

                    </select>

                </div>

                <div class="form-group" id="editSubcategoryGroup" style="display: none;">

                    <label>Subcategoria</label>

                    <select id="editSubcategory">

                        <option value="">Selecione a subcategoria</option>

                    </select>

                </div>

            </div>

            <div id="editInternalFields" class="hidden">

                <div class="form-group">

                    <label>Categoria de Trabalho Interno</label>

                    <select id="editInternalCategory" onchange="updateEditMeetingProjects()">

                        <option value="reuniao">Reuni√£o</option>

                        <option value="formacao">Forma√ß√£o</option>

                    </select>

                </div>

                <div class="form-group" id="editMeetingProjectsGroup" style="display: none;">

                    <label>Obras Relacionadas (opcional)</label>

                    <div id="editMeetingProjectsList" class="checkbox-group"></div>

                    <div class="projects-count" id="editMeetingProjectsCount">0 obras selecionadas</div>

                </div>

                <div class="form-group">

                    <label>Descri√ß√£o</label>

                    <input type="text" id="editInternalDescription" placeholder="Ex: Reuni√£o semanal de equipa">

                </div>

            </div>

            <div class="form-group">

                <label>Data e Hora In√≠cio</label>

                <input type="datetime-local" id="editStartTime">

            </div>

            <div class="form-group">

                <label>Data e Hora Fim</label>

                <input type="datetime-local" id="editEndTime">

            </div>

            <div class="form-group">

                <label>Coment√°rio (opcional)</label>

                <textarea id="editComment" placeholder="Adicione observa√ß√µes..."></textarea>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-success" onclick="saveEdit()">üíæ Guardar</button>

                <button class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button>

            </div>

        </div>

    </div>



    <div id="manualEntryModal" class="modal">

        <div class="modal-content">

            <h2>‚ûï Adicionar Sess√£o Manual</h2>

            <div id="manualError" class="error-message hidden"></div>

            <div id="manualSuccess" class="success-message hidden"></div>

            <div class="radio-group">

                <div class="radio-option">

                    <input type="radio" id="manualWorkTypeProject" name="manualWorkType" value="project" checked onchange="updateManualFields()">

                    <label for="manualWorkTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>

                </div>

                <div class="radio-option internal">

                    <input type="radio" id="manualWorkTypeInternal" name="manualWorkType" value="internal" onchange="updateManualFields()">

                    <label for="manualWorkTypeInternal" class="radio-label">üè† Trabalho Interno</label>

                </div>

            </div>

            <div id="manualProjectFields">

                <div class="form-group">

                    <label>Selecione a Obra</label>

                    <select id="manualProjectSelect" onchange="updateManualProjectInfo()">

                        <option value="">-- Selecione uma obra --</option>

                    </select>

                </div>

                <div class="form-group">

                    <label>Departamento / Tipo de Projeto</label>

                    <select id="manualProjectType" onchange="updateManualSubcategories()">

                        <option value="">Selecione o departamento</option>

                        <option value="projeto">Projeto</option>

                        <option value="eletrico">El√©trico</option>

                        <option value="desenvolvimento">Desenvolvimento</option>

                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>

                    </select>

                </div>

                <div class="form-group" id="manualSubcategoryGroup" style="display: none;">

                    <label>Subcategoria</label>

                    <select id="manualSubcategory">

                        <option value="">Selecione a subcategoria</option>

                    </select>

                </div>

            </div>

            <div id="manualInternalFields" class="hidden">

                <div class="form-group">

                    <label>Categoria de Trabalho Interno</label>

                    <select id="manualInternalCategory" onchange="updateManualMeetingProjects()">

                        <option value="reuniao">Reuni√£o</option>

                        <option value="formacao">Forma√ß√£o</option>

                    </select>

                </div>

                <div class="form-group" id="manualMeetingProjectsGroup" style="display: none;">

                    <label>Obras Relacionadas (opcional)</label>

                    <div id="manualMeetingProjectsList" class="checkbox-group"></div>

                    <div class="projects-count" id="manualMeetingProjectsCount">0 obras selecionadas</div>

                </div>

                <div class="form-group">

                    <label>Descri√ß√£o</label>

                    <input type="text" id="manualInternalDescription" placeholder="Ex: Reuni√£o semanal de equipa">

                </div>

            </div>

            <div class="form-group">

                <label>Data e Hora In√≠cio</label>

                <input type="datetime-local" id="manualStartTime">

            </div>

            <div class="form-group">

                <label>Data e Hora Fim</label>

                <input type="datetime-local" id="manualEndTime">

            </div>

            <div class="form-group">

                <label>Coment√°rio (opcional)</label>

                <textarea id="manualComment" placeholder="Adicione observa√ß√µes..."></textarea>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-success" onclick="saveManualEntry()">üíæ Adicionar</button>

                <button class="btn btn-secondary" onclick="closeManualEntryModal()">Cancelar</button>

            </div>

        </div>

    </div>



    <div id="commentsModal" class="modal">

        <div class="modal-content">

            <h2>üí¨ Coment√°rios</h2>

            <div id="commentError" class="error-message hidden"></div>

            <div id="commentSuccess" class="success-message hidden"></div>

            <div class="info-panel" style="margin-bottom: 15px;">

                <div class="info-item">

                    <span class="label">Projeto:</span>

                    <span class="value" id="commentProject">-</span>

                </div>

                <div class="info-item">

                    <span class="label">C√≥digo:</span>

                    <span class="value" id="commentWorkCode">-</span>

                </div>

            </div>

            <div class="comment-list" id="commentsList"></div>

            <div class="form-group">

                <label>Novo Coment√°rio</label>

                <textarea id="newComment" placeholder="Escreva seu coment√°rio..."></textarea>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-primary" onclick="addComment()">‚ûï Adicionar</button>

                <button class="btn btn-secondary" onclick="closeCommentsModal()">Fechar</button>

            </div>

        </div>

    </div>



    <div id="dayModal" class="modal">

        <div class="modal-content">

            <h2 id="modalDayDate">Data</h2>

            <div id="modalDayContent"></div>

            <div class="modal-buttons">

                <button class="btn btn-secondary" onclick="closeDayModal()">Fechar</button>

            </div>

        </div>

    </div>



    <div id="singleVacationModal" class="modal">

        <div class="modal-content">

            <h2>üèñÔ∏è Marcar F√©rias</h2>

            <input type="hidden" id="singleVacationDate">

            <div class="form-group">

                <label>Observa√ß√£o (opcional)</label>

                <textarea id="singleVacationNote" placeholder="Ex: F√©rias de Ver√£o, Ponte, etc..."></textarea>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-success" onclick="confirmSingleVacation()">‚úì Marcar</button>

                <button class="btn btn-secondary" onclick="closeSingleVacationModal()">Cancelar</button>

            </div>

        </div>

    </div>



    <div id="singleAbsenceModal" class="modal">

        <div class="modal-content">

            <h2>‚ùå Marcar Falta</h2>

            <div id="absenceError" class="error-message hidden"></div>

            <input type="hidden" id="singleAbsenceDate">

            <div class="form-group">

                <label>Motivo da Falta *</label>

                <textarea id="singleAbsenceNote" placeholder="Ex: Consulta m√©dica, Assunto pessoal, etc..."></textarea>

            </div>

            <div class="info-panel" style="margin-top: 15px;">

                <p style="font-size: 12px; color: #6c757d;">‚ÑπÔ∏è O motivo da falta √© obrigat√≥rio para registo.</p>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-danger" onclick="confirmSingleAbsence()">‚úì Marcar</button>

                <button class="btn btn-secondary" onclick="closeSingleAbsenceModal()">Cancelar</button>

            </div>

        </div>

    </div>



    <div id="vacationPeriodModal" class="modal">

        <div class="modal-content">

            <h2>üèñÔ∏è Marcar Per√≠odo de F√©rias</h2>

            <div class="form-group">

                <label>Data de In√≠cio</label>

                <input type="date" id="vacationStartDate" onchange="updateVacationDaysCount()">

            </div>

            <div class="form-group">

                <label>Data de Fim</label>

                <input type="date" id="vacationEndDate" onchange="updateVacationDaysCount()">

            </div>

            <div class="form-group">

                <label>Observa√ß√£o (opcional)</label>

                <textarea id="vacationPeriodNote" placeholder="Ex: F√©rias de Ver√£o"></textarea>

            </div>

            <div class="vacation-days-count">

                <span style="color: #2e7d32;">üìÖ</span>

                <strong id="vacationDaysCount">0 dias</strong>

                <div style="font-size: 11px; color: #6c757d; margin-top: 5px;">(apenas dias √∫teis, excluindo domingos e feriados)</div>

            </div>

            <div class="info-panel" style="margin-top: 15px;">

                <p style="font-size: 12px; color: #6c757d;">‚ÑπÔ∏è Apenas dias √∫teis ser√£o marcados. Domingos e feriados s√£o automaticamente exclu√≠dos.</p>

            </div>

            <div class="modal-buttons">

                <button class="btn btn-success" onclick="confirmVacationPeriod()">‚úì Confirmar</button>

                <button class="btn btn-secondary" onclick="closeVacationPeriodModal()">Cancelar</button>

            </div>

        </div>

    </div>



    <div id="floatingTimer" class="floating-timer hidden">

        <div class="float-time">00:00:00</div>

        <div class="float-status">Parado</div>

    </div>



    <div class="container">

        <div class="header" id="mainHeader">
            
            <!-- Logo Ant√≠poda (fixo) -->
            <div class="header-logo">
                <img src="antipoda_lda_logo.png" alt="Ant√≠poda" class="company-logo-fixed">
            </div>

            <!-- T√≠tulo Central -->
            <div class="header-title">
                <h1>‚è±Ô∏è Controlo de Obra</h1>
                <p>Sistema de Gest√£o de Horas de Trabalho</p>
                <div id="adminBadge" class="admin-badge hidden">üõ°Ô∏è ADMINISTRADOR</div>
            </div>

            <!-- Foto de Perfil do Utilizador -->
            <div class="header-user-photo hidden" id="headerUserPhoto">
                <img id="headerPhotoImg" src="" alt="Perfil" class="header-photo">
                <div class="header-photo-placeholder" id="headerPhotoPlaceholder">
                    <span id="headerPhotoInitials">?</span>
                </div>
            </div>

        </div>




        <div id="loginScreen" class="content">

            <div id="loginError" class="error-message hidden"></div>

            <div class="form-group">

                <label for="loginUsername">Utilizador</label>

                <input type="text" id="loginUsername" placeholder="Nome de utilizador" onkeypress="if(event.key==='Enter')login()">

            </div>

            <div class="form-group">

                <label for="loginPassword">Password</label>

                <input type="password" id="loginPassword" placeholder="Password" onkeypress="if(event.key==='Enter')login()">

            </div>

            <button class="btn btn-primary" onclick="login()">Entrar</button>

            <button class="link-btn" onclick="showRegister()">Criar nova conta</button>

        </div>



        <div id="registerScreen" class="content hidden">

            <div id="registerError" class="error-message hidden"></div>

            <div id="registerSuccess" class="success-message hidden"></div>

            <div class="form-group">

                <label for="regFirstName">Primeiro Nome</label>

                <input type="text" id="regFirstName" placeholder="Primeiro nome" onkeypress="if(event.key==='Enter')register()">

            </div>

            <div class="form-group">

                <label for="regLastName">√öltimo Nome</label>

                <input type="text" id="regLastName" placeholder="√öltimo nome" onkeypress="if(event.key==='Enter')register()">

            </div>

            <div class="form-group">

                <label for="regDepartment">Departamento Padr√£o</label>

                <select id="regDepartment">

                    <option value="">Selecione seu departamento</option>

                    <option value="projeto">Projeto</option>

                    <option value="eletrico">El√©trico</option>

                    <option value="desenvolvimento">Desenvolvimento</option>

                    <option value="orcamentacao">Or√ßamenta√ß√£o</option>

                </select>

            </div>

            <div class="form-group">

                <label for="regUsername">Nome de Utilizador</label>

                <input type="text" id="regUsername" placeholder="M√≠nimo 3 caracteres" onkeypress="if(event.key==='Enter')register()">

            </div>

            <div class="form-group">

                <label for="regPassword">Password</label>

                <input type="password" id="regPassword" placeholder="M√≠nimo 6 caracteres" onkeypress="if(event.key==='Enter')register()">

            </div>

            <button class="btn btn-success" onclick="register()">Registar</button>

            <button class="link-btn" onclick="showLogin()">J√° tenho conta</button>

        </div>




        <div id="appScreen" class="content hidden">


            <div class="tabs" id="mainTabs">

                <button class="tab active" onclick="showMainTab(event, 'timer')">‚è±Ô∏è Timer</button>

                <button class="tab" onclick="showMainTab(event, 'dados')">üìä Dados</button>

                <button class="tab" onclick="showMainTab(event, 'obras')">üìã Obras</button>

                <button class="tab" onclick="showMainTab(event, 'calendario')">üìÖ Calend√°rio</button>

                <button class="tab admin-only-tab hidden" onclick="showMainTab(event, 'equipa')">üë• Equipa</button>

                <button class="tab" onclick="showMainTab(event, 'profile')">üë§ Perfil</button>

            </div>


            <div id="timerTab" class="tab-content active">

                <div class="timer-display">

                    <div class="time" id="currentTime">00:00:00</div>

                    <div class="date" id="currentDate">Data</div>

                </div>

                

                <div class="info-panel">

                    <div class="info-item">

                        <span class="label">Utilizador:</span>

                        <span class="value" id="userName">-</span>

                    </div>

                </div>



                <div class="radio-group">

                    <div class="radio-option">

                        <input type="radio" id="workTypeProject" name="workType" value="project" checked onchange="updateWorkTypeFields()">

                        <label for="workTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>

                    </div>

                    <div class="radio-option internal">

                        <input type="radio" id="workTypeInternal" name="workType" value="internal" onchange="updateWorkTypeFields()">

                        <label for="workTypeInternal" class="radio-label">üè† Trabalho Interno</label>

                    </div>

                </div>



                <div id="projectFields">

                    <div class="form-group">

                        <label for="projectSelect">Selecionar Obra</label>

                        <select id="projectSelect" onchange="updateProjectInfo()">

                            <option value="">-- Selecione uma obra aberta --</option>

                        </select>

                    </div>

                    <div class="form-group">

                        <label for="projectType">Departamento / Tipo de Projeto</label>

                        <select id="projectType" onchange="updateSubcategories()">

                            <option value="">Selecione o departamento</option>

                            <option value="projeto">Projeto</option>

                            <option value="eletrico">El√©trico</option>

                            <option value="desenvolvimento">Desenvolvimento</option>

                            <option value="orcamentacao">Or√ßamenta√ß√£o</option>

                        </select>

                    </div>

                    <div class="form-group" id="subcategoryGroup" style="display: none;">

                        <label for="subcategory">Subcategoria</label>

                        <select id="subcategory">

                            <option value="">Selecione a subcategoria</option>

                        </select>

                    </div>

                </div>



                <div id="internalFields" class="hidden">

                    <div class="form-group">

                        <label for="internalCategory">Categoria de Trabalho Interno</label>

                        <select id="internalCategory" onchange="updateMeetingProjects()">

                            <option value="reuniao">Reuni√£o</option>

                            <option value="formacao">Forma√ß√£o</option>

                        </select>

                    </div>

                    <div class="form-group" id="meetingProjectsGroup" style="display: none;">

                        <label>Obras Relacionadas (opcional)</label>

                        <div id="meetingProjectsList" class="checkbox-group"></div>

                        <div class="projects-count" id="meetingProjectsCount">0 obras selecionadas</div>

                    </div>

                    <div class="form-group">

                        <label for="internalDescription">Descri√ß√£o</label>

                        <input type="text" id="internalDescription" placeholder="Ex: Reuni√£o semanal de equipa">

                    </div>

                </div>



                <div id="timerError" class="error-message hidden"></div>

                <!-- Meta Di√°ria -->
                <div class="daily-goal-section">
                    <div class="daily-goal-header">
                        <span>üéØ Meta Di√°ria</span>
                        <select id="dailyGoalSelect" onchange="updateDailyGoal()">
                            <option value="0">Sem meta</option>
                            <option value="4">4 horas</option>
                            <option value="6">6 horas</option>
                            <option value="8" selected>8 horas</option>
                            <option value="9">9 horas</option>
                            <option value="10">10 horas</option>
                        </select>
                    </div>
                    <div class="daily-goal-progress">
                        <div class="daily-goal-bar">
                            <div class="daily-goal-fill" id="dailyGoalFill" style="width: 0%"></div>
                        </div>
                        <div class="daily-goal-text">
                            <span id="dailyGoalCurrent">0h 0m</span> / <span id="dailyGoalTarget">8h</span>
                            <span id="dailyGoalPercent">(0%)</span>
                        </div>
                    </div>
                </div>

                <!-- Repetir √∫ltima sess√£o -->
                <div id="lastSessionPanel" class="last-session-panel hidden">
                    <div class="last-session-info">
                        <span class="last-session-label">√öltima sess√£o:</span>
                        <span id="lastSessionDesc" class="last-session-desc"></span>
                    </div>
                    <button class="btn btn-primary btn-small" onclick="repeatLastSession()">üîÑ Repetir</button>
                </div>

                <div class="work-timer" id="workTimerDisplay">

                    <div class="status" id="timerStatus">Parado</div>

                    <div class="timer" id="workTimer">00:00:00</div>

                    <div class="timer-controls">

                        <button class="btn btn-success" id="startBtn" onclick="startWork()">Iniciar</button>

                        <button class="btn btn-danger hidden" id="stopBtn" onclick="stopWork()">Parar</button>

                    </div>

                </div>



                <button class="btn btn-warning btn-manual-add" onclick="openManualEntry()">‚ûï Adicionar Sess√£o Manual</button>

            </div>



            <div id="dadosTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">üìä Dados</h3>
                <div class="dados-section">

                    <h4 style="margin-bottom: 15px; color: var(--primary-color);">üìÖ Hoje</h4>

                    


                    <div class="stat-card-large">

                        <div class="stat-value-large" id="todayTotalHours">0h 0m</div>

                        <div class="stat-label-large">‚è±Ô∏è Total Trabalhado</div>

                    </div>

                    


                    <div class="stats-grid-two">

                        <div class="stat-card" style="border-color: var(--secondary-color);">

                            <div class="stat-value" style="color: var(--secondary-color);" id="todayProjectHours">0h 0m</div>

                            <div class="stat-label">üè¢ Projeto</div>

                        </div>

                        <div class="stat-card" style="border-color: var(--internal-color);">

                            <div class="stat-value" style="color: var(--internal-color);" id="todayInternalHours">0h 0m</div>

                            <div class="stat-label">üè† Interno</div>

                        </div>

                    </div>

                    <!-- Gr√°fico circular de hoje -->
                    <div class="chart-container">
                        <canvas id="todayPieChart" width="200" height="200"></canvas>
                    </div>

                </div>




                <div class="dados-section">

                    <h4 style="margin-bottom: 15px; color: var(--primary-color);">üìä Esta Semana</h4>

                    


                    <div class="stat-card-large">

                        <div class="stat-value-large" id="weekTotalHours">0h 0m</div>

                        <div class="stat-label-large">‚è±Ô∏è Total Trabalhado</div>

                    </div>

                    


                    <div class="stats-grid-two">

                        <div class="stat-card" style="border-color: var(--secondary-color);">

                            <div class="stat-value" style="color: var(--secondary-color);" id="weekProjectHours">0h 0m</div>

                            <div class="stat-label">üè¢ Projeto</div>

                        </div>

                        <div class="stat-card" style="border-color: var(--internal-color);">

                            <div class="stat-value" style="color: var(--internal-color);" id="weekInternalHours">0h 0m</div>

                            <div class="stat-label">üè† Interno</div>

                        </div>

                    </div>

                    <!-- Gr√°fico circular da semana -->
                    <div class="chart-container">
                        <canvas id="weekPieChart" width="200" height="200"></canvas>
                    </div>

                </div>

                <!-- Resumo Mensal -->
                <div class="dados-section">
                    <h4 style="margin-bottom: 15px; color: var(--primary-color);">üìÜ Este M√™s</h4>
                    <div class="stat-card-large">
                        <div class="stat-value-large" id="monthTotalHours">0h 0m</div>
                        <div class="stat-label-large">‚è±Ô∏è Total Trabalhado</div>
                    </div>
                    <div class="stats-grid-two">
                        <div class="stat-card" style="border-color: var(--secondary-color);">
                            <div class="stat-value" style="color: var(--secondary-color);" id="monthProjectHours">0h 0m</div>
                            <div class="stat-label">üè¢ Projeto</div>
                        </div>
                        <div class="stat-card" style="border-color: var(--internal-color);">
                            <div class="stat-value" style="color: var(--internal-color);" id="monthInternalHours">0h 0m</div>
                            <div class="stat-label">üè† Interno</div>
                        </div>
                    </div>
                    <!-- Gr√°fico circular do m√™s -->
                    <div class="chart-container">
                        <canvas id="monthPieChart" width="200" height="200"></canvas>
                    </div>
                    <!-- Gr√°fico de barras √∫ltimas 4 semanas -->
                    <div class="weekly-chart-container">
                        <h5 style="margin: 15px 0 10px 0; color: #666;">üìä √öltimas 4 Semanas</h5>
                        <div class="weekly-chart" id="weeklyChart"></div>
                    </div>
                </div>

                <div class="dados-section">

                    <h4 style="margin-bottom: 10px; color: var(--primary-color);">üìã Hist√≥rico Recente</h4>
                    
                    <!-- Pesquisa no hist√≥rico -->
                    <div class="history-search-container">
                        <input type="text" id="historySearch" placeholder="üîç Pesquisar por obra ou descri√ß√£o..." onkeyup="filterWorkHistory()">
                    </div>

                    <div id="workHistory" class="work-history"></div>

                </div>




                <div id="adminQuickStats" class="hidden dados-section">

                    <h4 style="margin-bottom: 15px; color: var(--admin-color);">üõ°Ô∏è Vista Administrativa - Hoje</h4>

                    <div class="stats-grid">

                        <div class="stat-card">

                            <div class="stat-value" id="adminTodayTotal">0h 0m</div>

                            <div class="stat-label">Total Geral</div>

                        </div>

                        <div class="stat-card" style="border-color: var(--secondary-color);">

                            <div class="stat-value" style="color: var(--secondary-color);" id="adminTodayProject">0h 0m</div>

                            <div class="stat-label">üè¢ Projeto</div>

                        </div>

                        <div class="stat-card" style="border-color: var(--internal-color);">

                            <div class="stat-value" style="color: var(--internal-color);" id="adminTodayInternal">0h 0m</div>

                            <div class="stat-label">üè† Interno</div>

                        </div>

                    </div>

                    

                    <h4 style="margin: 20px 0 15px 0; color: var(--admin-color);">üìä Vista Administrativa - Esta Semana</h4>

                    <div class="stats-grid">

                        <div class="stat-card">

                            <div class="stat-value" id="adminWeekTotal">0h 0m</div>

                            <div class="stat-label">Total Geral</div>

                        </div>

                        <div class="stat-card" style="border-color: var(--secondary-color);">

                            <div class="stat-value" style="color: var(--secondary-color);" id="adminWeekProject">0h 0m</div>

                            <div class="stat-label">üè¢ Projeto</div>

                        </div>

                        <div class="stat-card" style="border-color: var(--internal-color);">

                            <div class="stat-value" style="color: var(--internal-color);" id="adminWeekInternal">0h 0m</div>

                            <div class="stat-label">üè† Interno</div>

                        </div>

                    </div>



                    <h4 style="margin: 20px 0 15px 0; color: var(--admin-color);">üìà Resumo Geral</h4>

                    <div class="stats-grid">

                        <div class="stat-card">

                            <div class="stat-value" id="dashCompanyTotalUsers">0</div>

                            <div class="stat-label">Utilizadores</div>

                        </div>

                        <div class="stat-card">

                            <div class="stat-value" id="dashCompanyTotalProjects">0</div>

                            <div class="stat-label">Obras Ativas</div>

                        </div>

                        <div class="stat-card">

                            <div class="stat-value" id="dashCompanyTotalSessions">0</div>

                            <div class="stat-label">Sess√µes Totais</div>

                        </div>

                        <div class="stat-card">

                            <div class="stat-value" id="dashCompanyTotalHours">0h</div>

                            <div class="stat-label">Horas Totais (Global)</div>

                        </div>

                    </div>

                </div>

            </div>

            <div id="obrasTab" class="tab-content">

                <h3 style="margin-bottom: 20px;">üìã Obras</h3>

                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="showSubTab(event, 'obras', 'lista')">üìã Lista</button>
                    <button class="sub-tab" onclick="showSubTab(event, 'obras', 'horas')">‚è±Ô∏è Horas por Obra</button>
                    <button class="sub-tab" onclick="showSubTab(event, 'obras', 'reaberturas')">üîÑ Reaberturas</button>
                    <button class="sub-tab" onclick="showSubTab(event, 'obras', 'comments')">üí¨ Coment√°rios</button>
                </div>

                <div id="obras-lista" class="sub-content active">

                    <button id="newProjectBtn" class="btn btn-success" onclick="openNewProjectModal()" style="margin-bottom: 20px;">üÜï Abrir Nova Obra</button>

                    <div id="projectsStatsPanel" class="info-panel" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--primary-color);">üìä Estat√≠sticas R√°pidas</h4>
                        <div class="stats-grid" style="margin-top: 10px;">
                            <div style="text-align: center; padding: 10px;">
                                <div style="font-size: 24px; font-weight: bold; color: var(--success-color);" id="statsOpenProjects">0</div>
                                <div style="font-size: 11px; color: #6c757d;">Obras Abertas</div>
                            </div>
                            <div style="text-align: center; padding: 10px;">
                                <div style="font-size: 24px; font-weight: bold; color: var(--accent-color);" id="statsClosedProjects">0</div>
                                <div style="font-size: 11px; color: #6c757d;">Obras Fechadas</div>
                            </div>
                            <div style="text-align: center; padding: 10px;">
                                <div style="font-size: 24px; font-weight: bold; color: var(--warning-color);" id="statsClientReopens">0</div>
                                <div style="font-size: 11px; color: #6c757d;">Reaberturas (Cliente)</div>
                            </div>
                            <div style="text-align: center; padding: 10px;">
                                <div style="font-size: 24px; font-weight: bold; color: var(--accent-color);" id="statsErrorReopens">0</div>
                                <div style="font-size: 11px; color: #6c757d;">Reaberturas (Erro Nosso)</div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label>Filtrar Obras</label>
                        <select id="projectStatusFilter" onchange="loadProjectsList()">
                            <option value="open">Obras Abertas</option>
                            <option value="closed">Obras Fechadas</option>
                            <option value="all">Todas as Obras</option>
                        </select>
                    </div>
                    <div id="projectsList" class="projects-list"></div>

                </div>

                <div id="obras-horas" class="sub-content">
                    <div class="info-panel" style="margin-bottom: 20px;">
                        <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">‚è±Ô∏è Consulte as horas trabalhadas em cada obra, filtradas por estado, departamento e subcategoria.</p>
                    </div>

                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Estado da Obra</label>
                            <select id="horasObraStatusFilter" onchange="updateHorasPorObra()">
                                <option value="all">Todas</option>
                                <option value="open">Abertas</option>
                                <option value="closed">Conclu√≠das</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Obra</label>
                            <select id="horasObraSelect" onchange="updateHorasPorObra()">
                                <option value="all">Todas as Obras</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Departamento</label>
                            <select id="horasObraDepartmentFilter" onchange="updateHorasPorObraSubcategories(); updateHorasPorObra()">
                                <option value="all">Todos</option>
                                <option value="projeto">Projeto</option>
                                <option value="eletrico">El√©trico</option>
                                <option value="desenvolvimento">Desenvolvimento</option>
                                <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                            </select>
                        </div>
                        <div class="filter-group" id="horasObraSubcategoryGroup">
                            <label>Subcategoria</label>
                            <select id="horasObraSubcategoryFilter" onchange="updateHorasPorObra()">
                                <option value="all">Todas</option>
                            </select>
                        </div>
                    </div>

                    <div class="horas-obra-summary">
                        <div class="horas-obra-stat">
                            <div class="horas-obra-stat-value" id="horasObraTotalHours">0h 0m</div>
                            <div class="horas-obra-stat-label">Total de Horas</div>
                        </div>
                        <div class="horas-obra-stat">
                            <div class="horas-obra-stat-value" id="horasObraTotalSessions">0</div>
                            <div class="horas-obra-stat-label">Sess√µes</div>
                        </div>
                        <div class="horas-obra-stat">
                            <div class="horas-obra-stat-value" id="horasObraTotalProjects">0</div>
                            <div class="horas-obra-stat-label">Obras</div>
                        </div>
                    </div>

                    <div class="horas-obra-actions">
                        <button class="btn btn-primary btn-small" onclick="exportHorasPorObraCSV()">üì• Exportar CSV</button>
                    </div>

                    <div id="horasObraList" class="horas-obra-list"></div>
                </div>

                <div id="obras-reaberturas" class="sub-content">
                    <div class="info-panel" style="margin-bottom: 20px;">
                        <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">üìä Estat√≠sticas de obras que foram reabertas ap√≥s conclus√£o. As horas mostradas s√£o apenas as trabalhadas ap√≥s a reabertura.</p>
                    </div>

                    <div class="reopen-stats-summary">
                        <div class="reopen-stat-card client">
                            <div class="reopen-stat-icon">üë§</div>
                            <div class="reopen-stat-content">
                                <div class="reopen-stat-title">Altera√ß√µes do Cliente</div>
                                <div class="reopen-stat-row">
                                    <span class="reopen-stat-label">Obras:</span>
                                    <span class="reopen-stat-value" id="reopenClientCount">0</span>
                                </div>
                                <div class="reopen-stat-row highlight">
                                    <span class="reopen-stat-label">Horas Ap√≥s Reabertura:</span>
                                    <span class="reopen-stat-value" id="reopenClientHours">0h</span>
                                </div>
                            </div>
                        </div>
                        <div class="reopen-stat-card error">
                            <div class="reopen-stat-icon">‚ö†Ô∏è</div>
                            <div class="reopen-stat-content">
                                <div class="reopen-stat-title">Erros Internos</div>
                                <div class="reopen-stat-row">
                                    <span class="reopen-stat-label">Obras:</span>
                                    <span class="reopen-stat-value" id="reopenErrorCount">0</span>
                                </div>
                                <div class="reopen-stat-row highlight">
                                    <span class="reopen-stat-label">Horas Ap√≥s Reabertura:</span>
                                    <span class="reopen-stat-value" id="reopenErrorHours">0h</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="reopen-sections">
                        <div class="reopen-section">
                            <h4 class="reopen-section-title client">üë§ Obras Reabertas por Altera√ß√£o do Cliente</h4>
                            <div id="reopenClientList" class="reopen-list"></div>
                        </div>
                        <div class="reopen-section">
                            <h4 class="reopen-section-title error">‚ö†Ô∏è Obras Reabertas por Erro Interno</h4>
                            <div id="reopenErrorList" class="reopen-list"></div>
                        </div>
                    </div>

                </div>

                <div id="obras-comments" class="sub-content">
                    <div class="info-panel" style="margin-bottom: 20px;">
                        <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Consulte e adicione coment√°rios √†s obras. Os coment√°rios ficam associados ao c√≥digo da obra.</p>
                    </div>
                    <div class="form-group">
                        <label>Selecione uma Obra</label>
                        <select id="selectWorkForComments" onchange="loadCommentsForWork()">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>
                    <div id="commentsDisplay" class="hidden">
                        <div class="comment-section">
                            <h4 style="margin-bottom: 10px;">Coment√°rios:</h4>
                            <div class="comment-list" id="workCommentsList"></div>
                            <div class="form-group" style="margin-top: 15px;">
                                <label>Adicionar Coment√°rio</label>
                                <textarea id="quickComment" placeholder="Escreva seu coment√°rio..."></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="addQuickComment()">‚ûï Adicionar</button>
                        </div>
                    </div>
                </div>

            </div>

            <div id="calendarioTab" class="tab-content">

                <h3 style="margin-bottom: 20px;">üìÖ Calend√°rio</h3>

                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="showSubTab(event, 'calendario', 'anual')">üìÖ Anual</button>
                    <button class="sub-tab" onclick="showSubTab(event, 'calendario', 'semanas')">üìä Semanas</button>
                </div>

                <div id="calendario-anual" class="sub-content active">
                    <div class="annual-calendar-container">
                        <div class="calendar-year-header">
                            <div class="year-display" id="currentYearDisplay">2026</div>
                            <div class="year-navigation">
                                <button class="year-nav-btn" onclick="goToCurrentYear()">Hoje</button>
                                <button class="year-nav-btn" onclick="changeYear(1)">Seguinte ‚ñ∂</button>
                            </div>
                        </div>

                        <div class="calendar-info-panel">
                            <p>
                                <strong>üìÖ Como funciona:</strong> 
                                Os dias trabalhados aparecem automaticamente a <strong style="color: #28a745;">verde</strong> baseados no seu hist√≥rico. 
                                <strong style="color: #2196F3;">Feriados nacionais</strong> üéâ est√£o marcados automaticamente. 
                                Clique em qualquer dia para marcar f√©rias <strong style="color: #ffc107;">üèñÔ∏è</strong> ou faltas <strong style="color: #dc3545;">‚ùå</strong>. 
                            </p>
                        </div>

                        <button class="quick-mark-vacation" onclick="openVacationPeriodModal()">
                            <span style="font-size: 24px;">üèñÔ∏è</span>
                            <span>Marcar Per√≠odo de F√©rias</span>
                        </button>

                        <div class="annual-stats">
                            <div class="annual-stat-card stat-worked">
                                <div class="stat-value" id="statWorkedDays">0</div>
                                <div class="stat-label">Dias Trabalhados</div>
                            </div>
                            <div class="annual-stat-card stat-vacation">
                                <div class="stat-value" id="statVacationDays">0</div>
                                <div class="stat-label">Dias de F√©rias</div>
                            </div>
                            <div class="annual-stat-card stat-absence">
                                <div class="stat-value" id="statAbsenceDays">0</div>
                                <div class="stat-label">Faltas</div>
                            </div>
                            <div class="annual-stat-card stat-holiday">
                                <div class="stat-value" id="statHolidayDays">0</div>
                                <div class="stat-label">Feriados</div>
                            </div>
                            <div class="annual-stat-card stat-weekend">
                                <div class="stat-value" id="statWeekendDays">0</div>
                                <div class="stat-label">Domingos</div>
                            </div>
                            <div class="annual-stat-card stat-remaining">
                                <div class="stat-value" id="statRemainingDays">0</div>
                                <div class="stat-label">Dias Restantes</div>
                            </div>
                        </div>

                        <div class="annual-calendar-grid" id="annualCalendarGrid"></div>

                        <div class="calendar-legend">
                            <div class="legend-item">
                                <div class="legend-icon worked">üíº</div>
                                <span>Dia Trabalhado</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-icon vacation">üèñÔ∏è</div>
                                <span>F√©rias</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-icon absence">‚ùå</div>
                                <span>Falta</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-icon holiday">üéâ</div>
                                <span>Feriado</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-icon weekend">üè†</div>
                                <span>Domingo</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="calendario-semanas" class="sub-content">
                    <div class="info-panel" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--primary-color);">üìä Horas Trabalhadas por Semana</h4>
                        <p style="font-size: 12px; color: #6c757d;">Visualize as horas trabalhadas em cada semana do ano</p>
                    </div>

                    <div class="filter-section weeks-filters">
                        <div class="filter-group">
                            <label>üìÖ Ano</label>
                            <select id="weeksYearFilter" onchange="updateWeeksMonthFilter()">
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>üìÜ M√™s</label>
                            <select id="weeksMonthFilter" onchange="updateWeeksWeekFilter()">
                                <option value="all">Todos os meses</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>üóìÔ∏è Semana</label>
                            <select id="weeksWeekFilter" onchange="updateWeeksView()">
                                <option value="all">Todas as semanas</option>
                            </select>
                        </div>
                    </div>

                    <div id="weeksContainer" class="weeks-container"></div>
                </div>

            </div>

            <div id="equipaTab" class="tab-content">

                <h3 style="margin-bottom: 20px;">üë• Equipa</h3>

                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="showSubTab(event, 'equipa', 'horas')">‚è±Ô∏è Horas</button>
                    <button class="sub-tab" onclick="showSubTab(event, 'equipa', 'obras')">üìã Obras</button>
                    <button class="sub-tab" onclick="showSubTab(event, 'equipa', 'reaberturas')">üîÑ Reaberturas</button>
                    <button class="sub-tab" onclick="showSubTab(event, 'equipa', 'calendarios')">üìÜ Calend√°rios</button>
                    <button class="sub-tab" onclick="showSubTab(event, 'equipa', 'utilizadores')">üõ°Ô∏è Utilizadores</button>
                </div>

                <div id="equipa-horas" class="sub-content active">

                    <div class="info-panel admin-panel" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--admin-color);">üë• Horas da Equipa</h4>
                        <p style="font-size: 12px; color: #6c757d;">Visualize e filtre as horas debitadas por cada utilizador da equipa</p>
                    </div>

                    <div class="filter-section team-hours-filters">
                        <div class="filter-group">
                            <label>üë§ Utilizador</label>
                            <select id="teamUserFilter" onchange="updateTeamHoursView()">
                                <option value="all">Todos os Utilizadores</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>üìÖ Per√≠odo</label>
                            <select id="teamPeriodFilter" onchange="updateTeamHoursView()">
                                <option value="today">Hoje</option>
                                <option value="week" selected>Esta Semana</option>
                                <option value="month">Este M√™s</option>
                                <option value="year">Este Ano</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </div>
                        <div class="filter-group" id="teamCustomDateGroup" style="display: none;">
                            <label>üìÜ De</label>
                            <input type="date" id="teamDateFrom" onchange="updateTeamHoursView()">
                        </div>
                        <div class="filter-group" id="teamCustomDateToGroup" style="display: none;">
                            <label>üìÜ At√©</label>
                            <input type="date" id="teamDateTo" onchange="updateTeamHoursView()">
                        </div>
                        <div class="filter-group">
                            <label>üè∑Ô∏è Tipo de Trabalho</label>
                            <select id="teamWorkTypeFilter" onchange="updateTeamHoursView()">
                                <option value="all">Todos</option>
                                <option value="project">Projeto</option>
                                <option value="internal">Interno</option>
                            </select>
                        </div>
                        <div class="filter-group" id="teamDepartmentGroup">
                            <label>üè¢ Departamento</label>
                            <select id="teamDepartmentFilter" onchange="updateTeamHoursView()">
                                <option value="all">Todos</option>
                                <option value="projeto">Projeto</option>
                                <option value="eletrico">El√©trico</option>
                                <option value="desenvolvimento">Desenvolvimento</option>
                                <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                            </select>
                        </div>
                    </div>

                    <div class="team-hours-summary">
                        <div class="team-hours-stat">
                            <div class="team-hours-stat-value" id="teamTotalHours">0h</div>
                            <div class="team-hours-stat-label">Total</div>
                        </div>
                        <div class="team-hours-stat project">
                            <div class="team-hours-stat-value" id="teamProjectHours">0h</div>
                            <div class="team-hours-stat-label">üè¢ Projeto</div>
                        </div>
                        <div class="team-hours-stat internal">
                            <div class="team-hours-stat-value" id="teamInternalHours">0h</div>
                            <div class="team-hours-stat-label">üè† Interno</div>
                        </div>
                        <div class="team-hours-stat sessions">
                            <div class="team-hours-stat-value" id="teamTotalSessions">0</div>
                            <div class="team-hours-stat-label">üìù Sess√µes</div>
                        </div>
                    </div>

                    <div class="team-hours-table-container">
                        <h4 style="margin: 20px 0 15px 0; color: var(--admin-color);">üìä Resumo por Utilizador</h4>
                        <div class="team-hours-table" id="teamHoursTable"></div>
                    </div>

                    <div class="team-sessions-container">
                        <h4 style="margin: 20px 0 15px 0; color: var(--admin-color);">üìã Detalhe das Sess√µes</h4>
                        <div id="teamSessionsList" class="work-history"></div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="exportTeamHoursCSV()">üìÑ Exportar CSV</button>
                        <button class="btn btn-primary" onclick="exportTeamHoursJSON()">üìã Exportar JSON</button>
                    </div>

                </div>

                <div id="equipa-obras" class="sub-content">

                    <div class="info-panel admin-panel" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--admin-color);">üìã Horas por Obra (Equipa)</h4>
                        <p style="font-size: 12px; color: #6c757d;">Visualize o total de horas gastas em cada obra por todos os utilizadores da equipa</p>
                    </div>

                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Estado da Obra</label>
                            <select id="projectHoursStatusFilter" onchange="updateAdminProjectSelect(); updateProjectHoursView()">
                                <option value="all">Todas</option>
                                <option value="open">Abertas</option>
                                <option value="closed">Conclu√≠das</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Obra</label>
                            <select id="projectHoursObraSelect" onchange="updateProjectHoursView()">
                                <option value="all">Todas as Obras</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Departamento</label>
                            <select id="projectHoursDeptFilter" onchange="updateAdminSubcategories(); updateProjectHoursView()">
                                <option value="all">Todos</option>
                                <option value="projeto">Projeto</option>
                                <option value="eletrico">El√©trico</option>
                                <option value="desenvolvimento">Desenvolvimento</option>
                                <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                            </select>
                        </div>
                        <div class="filter-group" id="adminSubcategoryGroup">
                            <label>Subcategoria</label>
                            <select id="projectHoursSubcategoryFilter" onchange="updateProjectHoursView()">
                                <option value="all">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Utilizador</label>
                            <select id="projectHoursUserFilter" onchange="updateProjectHoursView()">
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Pesquisar</label>
                            <input type="text" id="projectHoursSearch" placeholder="C√≥digo ou nome..." oninput="updateProjectHoursView()">
                        </div>
                    </div>

                    <div class="horas-obra-summary">
                        <div class="horas-obra-stat">
                            <div class="horas-obra-stat-value" id="totalProjectsHours">0h 0m</div>
                            <div class="horas-obra-stat-label">Total de Horas</div>
                        </div>
                        <div class="horas-obra-stat">
                            <div class="horas-obra-stat-value" id="totalProjectsSessions">0</div>
                            <div class="horas-obra-stat-label">Sess√µes</div>
                        </div>
                        <div class="horas-obra-stat">
                            <div class="horas-obra-stat-value" id="totalProjectsCount">0</div>
                            <div class="horas-obra-stat-label">Obras</div>
                        </div>
                        <div class="horas-obra-stat">
                            <div class="horas-obra-stat-value" id="totalProjectsUsers">0</div>
                            <div class="horas-obra-stat-label">Utilizadores</div>
                        </div>
                    </div>

                    <div class="horas-obra-actions">
                        <button class="btn btn-admin btn-small" onclick="exportProjectHoursCSV()">üì• Exportar CSV</button>
                    </div>

                    <div id="projectHoursTable" class="horas-obra-list"></div>

                </div>

                <div id="equipa-reaberturas" class="sub-content">

                    <div class="info-panel admin-panel" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--admin-color);">üîÑ Reaberturas da Equipa</h4>
                        <p style="font-size: 12px; color: #6c757d;">Visualize as horas gastas em obras reabertas por todos os utilizadores</p>
                    </div>

                    <div class="reopen-stats-summary">
                        <div class="reopen-stat-card total">
                            <div class="reopen-stat-icon">üìä</div>
                            <div class="reopen-stat-content">
                                <div class="reopen-stat-title">Total Geral</div>
                                <div class="reopen-stat-row">
                                    <span class="reopen-stat-label">Obras Reabertas:</span>
                                    <span class="reopen-stat-value" id="adminReopenTotalCount">0</span>
                                </div>
                                <div class="reopen-stat-row highlight">
                                    <span class="reopen-stat-label">Total Horas:</span>
                                    <span class="reopen-stat-value" id="adminReopenTotalHours">0h</span>
                                </div>
                            </div>
                        </div>
                        <div class="reopen-stat-card client">
                            <div class="reopen-stat-icon">üë§</div>
                            <div class="reopen-stat-content">
                                <div class="reopen-stat-title">Altera√ß√µes do Cliente</div>
                                <div class="reopen-stat-row">
                                    <span class="reopen-stat-label">Obras:</span>
                                    <span class="reopen-stat-value" id="adminReopenClientCount">0</span>
                                </div>
                                <div class="reopen-stat-row highlight">
                                    <span class="reopen-stat-label">Horas:</span>
                                    <span class="reopen-stat-value" id="adminReopenClientHours">0h</span>
                                </div>
                            </div>
                        </div>
                        <div class="reopen-stat-card error">
                            <div class="reopen-stat-icon">‚ö†Ô∏è</div>
                            <div class="reopen-stat-content">
                                <div class="reopen-stat-title">Erros Internos</div>
                                <div class="reopen-stat-row">
                                    <span class="reopen-stat-label">Obras:</span>
                                    <span class="reopen-stat-value" id="adminReopenErrorCount">0</span>
                                </div>
                                <div class="reopen-stat-row highlight">
                                    <span class="reopen-stat-label">Horas:</span>
                                    <span class="reopen-stat-value" id="adminReopenErrorHours">0h</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h4 style="margin: 25px 0 15px; color: var(--admin-color);">üë• Horas por Utilizador</h4>
                    <div class="admin-reopen-users-table" id="adminReopenUsersTable"></div>

                    <h4 style="margin: 25px 0 15px; color: var(--admin-color);">üìã Detalhe por Obra</h4>
                    <div class="admin-reopen-projects-list" id="adminReopenProjectsList"></div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="exportAdminReopensCSV()">üìÑ Exportar CSV</button>
                    </div>

                </div>

                <div id="equipa-calendarios" class="sub-content">

                    <div class="info-panel admin-panel" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--admin-color);">üìÜ Calend√°rios da Equipa</h4>
                        <p style="font-size: 12px; color: #6c757d;">Visualize o calend√°rio de cada utilizador para controlar f√©rias e dias trabalhados</p>
                    </div>

                    <div class="filter-section">
                        <div class="filter-group">
                            <label>üë§ Selecionar Utilizador</label>
                            <select id="teamCalendarUserFilter" onchange="loadTeamCalendarView()">
                                <option value="">Selecione um utilizador</option>
                            </select>
                        </div>
                    </div>

                    <div id="teamVacationsSummary" class="team-vacations-summary"></div>

                    <div id="teamCalendarStats" class="hidden">
                        <div class="team-calendar-header">
                            <div class="team-calendar-user-info">
                                <span class="team-calendar-user-icon">üë§</span>
                                <span id="teamCalendarUserName">-</span>
                            </div>
                            <div class="calendar-year-header">
                                <div class="year-display" id="teamCalendarYearDisplay">2026</div>
                                <div class="year-navigation">
                                    <button class="year-nav-btn" onclick="changeTeamCalendarYear(-1)">‚óÄ Anterior</button>
                                    <button class="year-nav-btn" onclick="goToTeamCurrentYear()">Hoje</button>
                                    <button class="year-nav-btn" onclick="changeTeamCalendarYear(1)">Seguinte ‚ñ∂</button>
                                </div>
                            </div>
                        </div>

                        <div class="annual-stats team-annual-stats">
                            <div class="annual-stat-card stat-worked">
                                <div class="stat-value" id="teamStatWorkedDays">0</div>
                                <div class="stat-label">Dias Trabalhados</div>
                            </div>
                            <div class="annual-stat-card stat-vacation">
                                <div class="stat-value" id="teamStatVacationDays">0</div>
                                <div class="stat-label">Dias de F√©rias</div>
                            </div>
                            <div class="annual-stat-card stat-absence">
                                <div class="stat-value" id="teamStatAbsenceDays">0</div>
                                <div class="stat-label">Faltas</div>
                            </div>
                            <div class="annual-stat-card stat-holiday">
                                <div class="stat-value" id="teamStatHolidayDays">0</div>
                                <div class="stat-label">Feriados</div>
                            </div>
                            <div class="annual-stat-card stat-weekend">
                                <div class="stat-value" id="teamStatWeekendDays">0</div>
                                <div class="stat-label">Domingos</div>
                            </div>
                            <div class="annual-stat-card stat-remaining">
                                <div class="stat-value" id="teamStatRemainingDays">0</div>
                                <div class="stat-label">Dias Restantes</div>
                            </div>
                        </div>

                        <div style="margin: 15px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="exportTeamCalendarCSV()">üìÑ Exportar Calend√°rio CSV</button>
                            <button class="btn btn-secondary" onclick="exportAllTeamCalendarsCSV()">üìä Exportar Todos CSV</button>
                        </div>
                    </div>

                    <div class="annual-calendar-grid team-calendar-grid" id="teamCalendarContainer">
                        <div class="empty-calendar-message">
                            <span style="font-size: 48px;">üìÖ</span>
                            <p>Selecione um utilizador para ver o calend√°rio</p>
                        </div>
                    </div>

                    <div class="calendar-legend" style="margin-top: 20px;">
                        <div class="legend-item">
                            <div class="legend-icon worked">üíº</div>
                            <span>Dia Trabalhado</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon vacation">üèñÔ∏è</div>
                            <span>F√©rias</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon absence">‚ùå</div>
                            <span>Falta</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon holiday">üéâ</div>
                            <span>Feriado</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon weekend">üè†</div>
                            <span>Domingo</span>
                        </div>
                    </div>

                </div>

                <div id="equipa-utilizadores" class="sub-content">

                    <div class="info-panel admin-panel" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--admin-color);">üõ°Ô∏è Gest√£o de Utilizadores</h4>
                        <p style="font-size: 12px; color: #6c757d;">Gerir utilizadores e permiss√µes de administrador</p>
                    </div>

                    <div class="stats-grid" style="margin-bottom: 20px;">
                        <div class="stat-card">
                            <div class="stat-value" id="totalUsersCount">0</div>
                            <div class="stat-label">Total Utilizadores</div>
                        </div>
                        <div class="stat-card" style="border-color: var(--admin-color);">
                            <div class="stat-value" style="color: var(--admin-color);" id="adminUsersCount">0</div>
                            <div class="stat-label">Administradores</div>
                        </div>
                        <div class="stat-card" style="border-color: var(--secondary-color);">
                            <div class="stat-value" style="color: var(--secondary-color);" id="regularUsersCount">0</div>
                            <div class="stat-label">Utilizadores Regulares</div>
                        </div>
                    </div>

                    <div id="adminUsersList" class="users-list"></div>

                </div>

            </div>

            <div id="dataTab" class="tab-content">

                <h3 style="margin-bottom: 20px;">üíæ Dados</h3>




                <div class="sub-tabs">

                    <button class="sub-tab active" onclick="showSubTab(event, 'data', 'reports')">üìä Relat√≥rios</button>

                    <button class="sub-tab" onclick="showSubTab(event, 'data', 'export')">üíæ Exportar</button>

                </div>




                <div id="data-reports" class="sub-content active">

                    <div class="filter-section">

                        <label>Filtrar por Tipo</label>

                        <select id="reportTypeFilter" onchange="updateReports()">

                            <option value="all">Todos os Trabalhos</option>

                            <option value="project">Trabalho de Projeto</option>

                            <option value="internal">Trabalho Interno</option>

                        </select>

                    </div>

                    <div class="filter-section" id="departmentFilterSection">

                        <label>Filtrar por Departamento</label>

                        <select id="reportFilter" onchange="updateReports()">

                            <option value="all">Todos os Departamentos</option>

                            <option value="projeto">Projeto</option>

                            <option value="eletrico">El√©trico</option>

                            <option value="desenvolvimento">Desenvolvimento</option>

                            <option value="orcamentacao">Or√ßamenta√ß√£o</option>

                        </select>

                    </div>

                    <div class="filter-section hidden" id="internalCategoryFilterSection">

                        <label>Filtrar por Categoria Interna</label>

                        <select id="internalCategoryFilter" onchange="updateReports()">

                            <option value="all">Todas as Categorias</option>

                            <option value="reuniao">Reuni√£o</option>

                            <option value="formacao">Forma√ß√£o</option>

                        </select>

                    </div>

                    <div class="stats-grid">

                        <div class="stat-card">

                            <div class="stat-value" id="totalProjectHours">0h</div>

                            <div class="stat-label">Total Horas Projeto</div>

                        </div>

                        <div class="stat-card">

                            <div class="stat-value" id="totalInternalHours">0h</div>

                            <div class="stat-label">Total Horas Interno</div>

                        </div>

                    </div>

                    <div class="form-group">

                        <label>Todas as Sess√µes</label>

                        <div id="fullHistory" class="work-history"></div>

                    </div>

                </div>




                <div id="data-export" class="sub-content">

                    <div class="info-panel" style="margin-bottom: 20px;">

                        <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Exporte os seus dados de controlo de horas para integra√ß√£o com sistemas PHC ou backup pessoal.</p>

                    </div>

                    <div class="button-group">

                        <button class="btn btn-primary" onclick="exportCSV()">üìÑ Exportar CSV</button>

                        <button class="btn btn-primary" onclick="exportJSON()">üìã Exportar JSON</button>

                    </div>

                    <h3 style="margin: 30px 0 20px 0;">Backup e Restauro</h3>

                    <div class="button-group">

                        <button class="btn btn-warning" onclick="backupData()">üíæ Backup Completo</button>

                        <button class="btn btn-secondary" onclick="document.getElementById('restoreFile').click()">üì• Restaurar</button>

                    </div>

                    <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(this)">

                    <div class="info-panel" style="margin-top: 20px;">

                        <div class="info-item">

                            <span class="label">Total de Sess√µes:</span>

                            <span class="value" id="exportSessionCount">0</span>

                        </div>

                        <div class="info-item">

                            <span class="label">Obras Registadas:</span>

                            <span class="value" id="exportProjectCount">0</span>

                        </div>

                        <div class="info-item">

                            <span class="label">Utilizadores Registados:</span>

                            <span class="value" id="exportUserCount">0</span>

                        </div>

                    </div>

                </div>

            </div>

            <div id="profileTab" class="tab-content">

                <h3 style="margin-bottom: 20px;">üë§ Perfil</h3>




                <div class="profile-main-content">

                    <div class="info-panel" style="margin-bottom: 20px;">

                        <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Visualize e edite as suas informa√ß√µes pessoais e credenciais de acesso.</p>

                    </div>

                    

                    <div id="profileError" class="error-message hidden"></div>

                    <div id="profileSuccess" class="success-message hidden"></div>

                    

                    <h4 style="margin: 20px 0 15px 0;">üì∑ Foto de Perfil</h4>

                    <div class="profile-photo-section">

                        <div class="profile-photo-container">

                            <img id="profilePhotoPreview" src="" alt="Foto de Perfil" class="profile-photo">

                            <div class="profile-photo-placeholder">

                                <span id="profileInitials">?</span>

                            </div>

                        </div>

                        <div class="profile-photo-actions">

                            <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;" onchange="handleProfilePhotoChange(event)">

                            <button class="btn btn-primary" onclick="document.getElementById('profilePhotoInput').click()">üì∑ Escolher Foto</button>

                            <button class="btn btn-secondary" onclick="removeProfilePhoto()" id="removePhotoBtn" style="display: none;">üóëÔ∏è Remover Foto</button>

                        </div>

                    </div>

                    

                    <h4 style="margin: 20px 0 15px 0;">üìã Informa√ß√µes Pessoais</h4>

                    <div class="form-group">

                        <label for="profileFirstName">Primeiro Nome</label>

                        <input type="text" id="profileFirstName" placeholder="Primeiro nome">

                    </div>

                    <div class="form-group">

                        <label for="profileLastName">√öltimo Nome</label>

                        <input type="text" id="profileLastName" placeholder="√öltimo nome">

                    </div>

                    <div class="form-group">

                        <label for="profileDepartment">Departamento Padr√£o</label>

                        <select id="profileDepartment">

                            <option value="">Selecione o departamento</option>

                            <option value="projeto">Projeto</option>

                            <option value="eletrico">El√©trico</option>

                            <option value="desenvolvimento">Desenvolvimento</option>

                            <option value="orcamentacao">Or√ßamenta√ß√£o</option>

                        </select>

                    </div>

                    <button class="btn btn-primary" onclick="updatePersonalInfo()">üíæ Guardar Informa√ß√µes</button>

                    

                    <h4 style="margin: 30px 0 15px 0;">üîê Credenciais de Acesso</h4>

                    <div class="form-group">

                        <label for="profileUsername">Nome de Utilizador</label>

                        <input type="text" id="profileUsername" placeholder="Nome de utilizador (m√≠nimo 3 caracteres)">

                    </div>

                    <button class="btn btn-warning" onclick="updateUsername()">‚úèÔ∏è Alterar Username</button>

                    

                    <h4 style="margin: 30px 0 15px 0;">üîë Alterar Password</h4>

                    <div class="form-group">

                        <label for="profileOldPassword">Password Atual</label>

                        <input type="password" id="profileOldPassword" placeholder="Password atual">

                    </div>

                    <div class="form-group">

                        <label for="profileNewPassword">Nova Password</label>

                        <input type="password" id="profileNewPassword" placeholder="Nova password (m√≠nimo 6 caracteres)">

                    </div>

                    <div class="form-group">

                        <label for="profileConfirmPassword">Confirmar Nova Password</label>

                        <input type="password" id="profileConfirmPassword" placeholder="Confirme a nova password">

                    </div>

                    <button class="btn btn-success" onclick="updatePassword()">üîí Alterar Password</button>

                    

                    <div class="info-panel" style="margin-top: 30px;">

                        <div class="info-item">

                            <span class="label">Tipo de Conta:</span>

                            <span class="value" id="profileAccountType">-</span>

                        </div>

                        <div class="info-item">

                            <span class="label">Membro desde:</span>

                            <span class="value">Utilizador existente</span>

                        </div>

                    </div>

                </div>



            </div>



            <button class="btn btn-secondary" onclick="logout()" style="margin-top: 20px;">Sair</button>

        </div>

    </div>



    <div id="teamDayModal" class="modal">
        <div class="modal-content">
            <h2>üìÖ Detalhes do Dia</h2>
            <div class="team-day-modal-header">
                <div class="team-modal-user">üë§ <span id="teamModalUserName">-</span></div>
                <div class="team-modal-date" id="teamModalDayDate">-</div>
            </div>
            <div id="teamModalDayContent"></div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeTeamDayModal()">Fechar</button>
            </div>
        </div>
    </div>



    <script src="calendar-simple.js"></script>

    <script src="admin.js"></script>

    <script src="app.js"></script>

</body>

</html>